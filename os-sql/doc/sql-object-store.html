<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
  <meta content="text/html; charset=ISO-8859-1"
 http-equiv="content-type">
  <link href="../style.css" rel="STYLESHEET">
  <title>SQL Object Store</title>
</head>
<body>
<h1>SQL Object Store</h1>
<h3>Structure</h3>
<p>The SQL Object Store contains a mapper for each class of Naked
Object that might be persisted.&nbsp; These mappers are specified and
configured at runtime via the framework
properties file.&nbsp; To create an alternative mapper you must
implement the ObjectMapper interface and register your class.&nbsp;
This
interface requires that you provide methods to access the instances of
your type, and methods to create, read, update and delete objects of
your type.&nbsp; There are various implementations of this interface in
org.nakedobjects.persistence.sql.auto, which you can extend if you wish.</p>
<p>The concrete implementations of the ObjectMapper make use of an
abstracted database connection, called DatabaseConnector.&nbsp; These
connections are generated by a DatabaseConnectorFactory, which also
must be
provided at startup (see the configuration details below).&nbsp; The
provided JDBC implementation (the org.nakedobjects.persistence.sql.jdbc
package) provides such a
factory - JdbcConnectorFactory - that provides database connections
using Java's JDBC.&nbsp; The JdbcConnector implementation simply maps
the requests made to the DatabaseConnector interface to JDBC specific
requests.&nbsp; Results from the database are encapsultaed in a Results
object that allows the rows in the result set to be traversed (forward
only),
and the column data to be extracted into the framework.&nbsp; Again a
JDBC implementation is provided by JdbcResults.<br>
</p>
<p>To connect to a database via another mechanism (other than JDBC)
all of the following interfaces need to be implemented:-<br>
</p>
<ol>
  <li>DatabaseConnector</li>
  <li>DatabaseConnectorFactory</li>
  <li>Results<br>
  </li>
</ol>
<p>In addition you might need to create an OidGenerator also to create
OID objects, but this is not strictly part of the Object Store itself,
although it woud probably use the same facilities.<br>
</p>
<p>Once a these connection classes have been implemented then the
mappers provided within org.nakedobjects.persistence.sql.auto will
be able to persist objects through the new connection.&nbsp; Additional
mappers can then be added as needed.<br>
</p>
<p>The most useful auto-mapper is the AutoMapper, which automatically
maps the contents of an object onto a corresponding table in the
database, creating the table first if necessary.&nbsp; </p>
<h3>Configuration<br>
</h3>
<p>The following configurations are taken from the
nakedobjects.properties file.</p>
<p>The first line specifies that we want to use the SQL Object Store
for storing our objects.&nbsp; Ensure there are no other lines in this
file with the same key.&nbsp; When running the SQL Object Store we must
specify at least the following: <br>
</p>
<ol>
  <li>
    <p>what type of connections we will be using;</p>
  </li>
  <li>
    <p>the auto-mapper factory;</p>
  </li>
  <li>
    <p>a default mapper, which will be used for mapping objects that
have no specific mapper specified later;</p>
  </li>
  <li>
    <p>a specific mapper for NakedClass objects</p>
  </li>
</ol>
<p>The following are settings used for the basic JDBC based behaviour:<br>
</p>
<pre>nakedobjects.object-store=org.nakedobjects.persistence.sql.SqlObjectStore</pre>
<pre>nakedobjects.sql-object-store.connector=org.nakedobjects.persistence.sql.jdbc.JdbcConnectorFactory</pre>
<pre>nakedobjects.sql-object-store.automapper=org.nakedobjects.persistence.sql.auto.AutoMapperFactory</pre>
<pre>nakedobjects.sql-object-store.default-mapper=org.nakedobjects.persistence.sql.auto.NameBasedMapper</pre>
<pre>nakedobjects.sql-object-store.class-mapper=&nbsp; org.nakedobjects.persistence.sql.auto.DefaultNakedClassMapper</pre>
<p>In addition we specify a specific OID generator (this is to
keep the tables primary keys in order).</p>
<pre>nakedobjects.oidgenerator=org.nakedobjects.persistence.sql.jdbc.JdbcOidGenerator</pre>
<p>For the JDBC connector, as specified above, we need to provide
details
about how we access the database using JDBC.&nbsp; The following
indicates that we want use the <span style="font-weight: bold;">SQLServer
</span>driver from microsoft, to establish a connection to
a <span style="font-weight: bold;">db-nof </span>database, and that
the user is <span style="font-weight: bold;">sa</span>, while there is
no password.<br>
</p>
<pre>nakedobjects.sql-object-store.jdbc.driver=com.microsoft.jdbc.sqlserver.SQLServerDriver</pre>
<pre>nakedobjects.sql-object-store.jdbc.connection=jdbc:microsoft:sqlserver://localhost;selectMethod=cursor;databaseName=db-nof</pre>
<pre>nakedobjects.sql-object-store.jdbc.user=sa</pre>
<pre>nakedobjects.sql-object-store.jdbc.password=</pre>
<p>To assist the interactions with the database a set of low level
mapping can also be specified.&nbsp;&nbsp; These specify what object in
Naked Objects should be mapped to which column types in the
database.&nbsp; The following are suitable for SQLServer.</p>
<pre>nakedobjects.sql-object-store.typemapper.OID=int</pre>
<pre>nakedobjects.sql-object-store.typemapper.org.nakedobjects.object.value.TextString=varchar(255)</pre>
<pre>nakedobjects.sql-object-store.typemapper.org.nakedobjects.object.value.Option=varchar(255)</pre>
<pre>nakedobjects.sql-object-store.typemapper.org.nakedobjects.object.value.MultilineTextString=varchar(1024)</pre>
<pre>nakedobjects.sql-object-store.typemapper.org.nakedobjects.object.value.Date=datetime</pre>
<pre>nakedobjects.sql-object-store.typemapper.org.nakedobjects.object.value.TimeStamp=datetime</pre>
<pre>nakedobjects.sql-object-store.typemapper.org.nakedobjects.object.value.Logical=BIT</pre>
<p>Specific object mappings can be specified with the following mapping
pattern.
On the left, after the prefix <span style="font-weight: bold;">nakedobjects.sql-object-store.mapper.</span>
specify the class on Naked Object, and, after the equals sign, the
mapper to use.&nbsp; The first example maps the User class to a
specific user mapper, and the second specifies that the automatic
mapper is&nbsp; used for Role objects.<br>
</p>
<pre>nakedobjects.sql-object-store.mapper.org.nakedobjects.security.User=&nbsp; org.nakedobjects.persistence.sql.auto.UserMapper<br></pre>
<pre>nakedobjects.sql-object-store.mapper.org.nakedobjects.security.Role=&nbsp; auto</pre>
<br>
<br>
#nakedobjects.sql-object-store.mapper.dsfa.business.object.Customer=&nbsp;&nbsp;
dsfa.objectstore.CustomerMapper<br>
#nakedobjects.sql-object-store.mapper.dsfa.business.object.Customer=&nbsp;
auto.customer<br>
#nakedobjects.sql-object-store.automapper.customer.all-fields=off<br>
#nakedobjects.sql-object-store.automapper.customer.table=Customer<br>
#nakedobjects.sql-object-store.automapper.customer.id=PKCustomerID<br>
#nakedobjects.sql-object-store.automapper.customer.column.KnownAsSurname=Lastname<br>
#nakedobjects.sql-object-store.automapper.customer.column.KnownAsForename=Forename<br>
#nakedobjects.sql-object-store.automapper.customer.column.PKPPSN=Ppsn<br>
<br>
<br>
<h3>Creating new Mappers</h3>
<p>The simplest way to create a new mapper is to extend
AbstractObjectMapper as it provides you with automatic set up,
including an initialised connection.&nbsp; Specifically, it provides
you
with a mechnism for getting a primary key ID (as a long number) from an
OID.&nbsp; In your subclass you need to implement all the remaining
method from the ObjectMapper interface.&nbsp; As these can be
reasonably long and complex, start by implementing getInstances()
(where all three methods can start off as one implementation), and
resolve().&nbsp; These basic methods will allow you to see objects with
data from the
database (assuming the database is already populated).&nbsp; To ensure
you can inovoke the instances methods from the class viewers, implement
hasInstances() to
return true, and numberOfInstances() to return a number greater than
zero.&nbsp; Follow these instance methods with create() and save()
methods so the objects
can now be persisted,&nbsp; Finally, implement the destroy(), and the
skipped
hasInstances() and numberOfInstances() method to complete the mapper.<br>
</p>
<p><br>
</p>
</body>
</html>
